# 機能要件書

## 1. システム概要

### 1.1 プロジェクト目的
- 社内の管理業務をITツール化し、費用の削減と効率化の両立を目指す
- 業務の可視化と効率化による生産性向上

### 1.2 主要機能
1. **予定実績管理** - 日々の業務予定と実績を管理
2. **課題登録** - プロジェクトの課題を一元管理
3. **進捗管理（ガントチャート）** - プロジェクトの進捗を視覚的に管理

## 2. 技術要件

### 2.1 技術スタック
- **フレームワーク**: Next.js
- **UIコンポーネント**: Shadcn UI (https://ui.shadcn.com/)
- **ホスティング**: Vercel
- **データベース**: PostgreSQL (Neon - 無料プラン)

### 2.2 非機能要件
- レスポンシブデザイン対応
- セキュアな認証・認可システム
- データの整合性保証

## 3. 共通機能要件

### 3.1 認証機能

#### 3.1.1 ログイン機能
- **認証方式**: メールアドレス・パスワード認証
- **必須項目**:
  - メールアドレス
  - パスワード
- **セキュリティ要件**:
  - パスワードのハッシュ化
  - セッション管理
  - パスワードリセット機能

### 3.2 権限管理
- **権限種別**:
  - 管理者権限
  - 一般ユーザー権限
- **権限による機能制限**:
  - ユーザー管理機能は管理者権限のみアクセス可能

### 3.3 共通データベース要件
全テーブルに以下のフィールドを必須とする：
- **作成者** (created_by)
- **作成日時** (created_at)
- **更新者** (updated_by)
- **更新日時** (updated_at)

## 4. 機能別詳細要件

### 4.1 ユーザー管理機能

#### 4.1.1 アクセス制御
- 管理者権限を持つユーザーのみアクセス可能

#### 4.1.2 管理項目
| 項目名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| 表示名 | String | ○ | ユーザーの表示名 |
| メールアドレス | String | ○ | ログイン用メールアドレス（一意） |
| パスワード | String | ○ | ハッシュ化して保存 |
| 管理者権限 | Boolean | ○ | true: 管理者 / false: 一般 |

#### 4.1.3 機能要件
- ユーザー一覧表示
- ユーザー新規登録
- ユーザー情報編集
- ユーザー削除（論理削除）
- パスワードリセット

### 4.2 案件管理機能

#### 4.2.1 画面構成
1. **一覧画面**
   - テーブル形式での表示
   - 表示項目: 案件番号、案件名、ステータス
   - ソート機能
   - フィルタリング機能
   - ページネーション

2. **登録・編集画面**
   - 新規登録フォーム
   - 編集フォーム
   - 削除機能（論理削除）

#### 4.2.2 データ項目
| 項目名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| 案件番号 | String | ○ | 一意の案件識別番号 |
| 案件名 | String | ○ | 案件の名称 |
| ステータス | Enum | ○ | 検討中/開発中/稼働中/停止中 |

#### 4.2.3 ステータス定義
- **検討中**: 案件の検討段階
- **開発中**: 開発作業中
- **稼働中**: 本番運用中
- **停止中**: 一時停止または終了

### 4.3 予定実績管理機能

#### 4.3.1 画面構成

1. **一覧画面（テーブル形式）**
   - 日付順での表示
   - ユーザー別フィルタリング
   - 期間指定検索

2. **カレンダー画面**
   - 月表示/週表示/日表示切り替え
   - 予定・実績の視覚的表示
   - ドラッグ&ドロップによる日付変更

3. **グラフ画面（横棒積み上げグラフ）**
   - **縦軸**: 作成者（ユーザー）
   - **横軸**: 実績時間（時間単位）
   - **横棒**: 案件ごとの実績時間の積み上げ表示
   - **フィルタリング**: 期間指定による絞り込み
   - **詳細表示**: グラフ要素クリックで詳細情報表示

#### 4.3.2 入力項目

##### 基本情報
| 項目名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| 日付 | Date | ○ | YYYY-MM-DD形式 |
| 出社時刻 | Time | × | HH:mm形式 |
| 退社時刻 | Time | × | HH:mm形式 |
| 所感 | Text | × | 一日の振り返り・コメント |

##### 予定情報（複数登録可能）
| 項目名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| 予定案件 | Select | ○ | 案件管理から選択 |
| 案件内容 | TextArea | × | 予定の詳細内容 |

##### 実績情報（複数登録可能）
| 項目名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| 実績案件 | Select | ○ | 案件管理から選択 |
| 実績時間 | Number | ○ | 時間単位（0.25h刻み） |
| 実績内容 | TextArea | × | 実施内容の詳細 |

#### 4.3.3 機能要件
- 動的フォーム（プラスボタンで入力欄追加）
- 案件マスタとの連携（セレクトボックス）
- 実績時間の自動集計

### 4.4 課題登録機能

#### 4.4.1 基本要件
- Backlogの課題登録機能を参考に実装
- 課題のステータス管理
- 優先度設定
- 担当者アサイン

#### 4.4.2 想定される機能項目
| 項目名 | 説明 |
|--------|------|
| 課題タイトル | 課題の概要 |
| 課題詳細 | 詳細な説明 |
| ステータス | 未対応/対応中/完了/保留 |
| 優先度 | 高/中/低 |
| 担当者 | ユーザーから選択 |
| 期限 | 対応期限日 |
| カテゴリ | 課題の分類 |
| コメント | 課題に対するコメント機能 |

#### 4.4.3 画面構成
- 課題一覧（フィルタリング・ソート機能付き）
- 課題詳細画面
- 課題登録・編集画面
- ダッシュボード（ステータス別集計表示）

### 4.5 進捗管理機能（ガントチャート）

#### 4.5.1 基本要件
- Backlogのガントチャート機能を参考に実装
- 課題登録機能との連携
- ドラッグ&ドロップによる期間変更

#### 4.5.2 表示要件
| 要素 | 説明 |
|------|------|
| タスクリスト | 左側に課題一覧を階層表示 |
| タイムライン | 日/週/月単位での表示切り替え |
| 進捗バー | 各タスクの期間と進捗率を視覚化 |
| マイルストーン | 重要な期日をマーカー表示 |
| リソース表示 | 担当者別の負荷状況表示 |

#### 4.5.3 機能要件
- タスクの親子関係設定
- 進捗率の更新（0-100%）
- クリティカルパス表示

## 5. データベース設計要件

### 5.1 テーブル設計原則
- 正規化を適切に実施（第3正規形を基本）
- インデックスの適切な設定
- 外部キー制約による参照整合性の確保
- 論理削除の実装（deleted_atフィールド）

### 5.2 共通カラム
全テーブルに以下のカラムを含める：
```sql
created_by    INTEGER NOT NULL,  -- 作成者ID
created_at    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,  -- 作成日時
updated_by    INTEGER,  -- 更新者ID
updated_at    TIMESTAMP,  -- 更新日時
deleted_at    TIMESTAMP  -- 論理削除日時
```

### 5.3 主要テーブル構成（概要）

#### users（ユーザー）
- id, display_name, email, password_hash, is_admin, etc.

#### projects（案件）
- id, project_number, project_name, status, etc.

#### schedules（予定実績）
- id, user_id, date, check_in_time, check_out_time, reflection, etc.

#### schedule_plans（予定詳細）
- id, schedule_id, project_id, content, etc.

#### schedule_actuals（実績詳細）
- id, schedule_id, project_id, hours, content, etc.

#### issues（課題）
- id, title, description, status, priority, assignee_id, due_date, etc.

#### gantt_tasks（ガントチャートタスク）
- id, issue_id, parent_id, start_date, end_date, progress, etc.
